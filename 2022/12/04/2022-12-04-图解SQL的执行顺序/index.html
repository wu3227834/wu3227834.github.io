<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="这里是小布丁的私有小屋">
    <meta property="og:type" content="website">
    <meta name="description" content="这里是小布丁的私有小屋">
    <meta name="keyword"  content="Pudding,Pudding的博客">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        图解SQL的执行顺序 - Pudding 个人博客
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Pudding 日常" type="application/atom+xml">
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> a week is 2% of the year </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.png" />
        </div>
        <div class="name">
            <i>Pudding</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>收藏</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%85%B3%E8%81%94%E8%BF%87%E7%A8%8B"><span class="toc-text">数据关联过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#from-amp-jion-amp-where"><span class="toc-text">from&amp;jion&amp;where</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by"><span class="toc-text">group by</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#having-amp-where"><span class="toc-text">having&amp;where</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-where-%E5%86%8D-group-by"><span class="toc-text">使用 where 再 group by</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-group-by-%E5%86%8D-where"><span class="toc-text">使用 group by 再 where</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select"><span class="toc-text">select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by"><span class="toc-text">order by</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limit"><span class="toc-text">limit</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> a week is 2% of the year </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        图解SQL的执行顺序
    </div>

    <div class="post-meta">
        <!-- <span class="attr">发布于：<span>2022-12-04 00:00:00</span></span> -->
        <span class="attr">发布于：<span>2022-12-04</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#sql" title="sql">sql</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <p>这是一条标准的查询语句：</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho1.jpg" alt="查询语句" title="查询语句.jpg"></p>
<p>这是我们实际上SQL执行的顺序：</p>
<ol>
<li>执行 from，join 来确定表之间的连接关系，得到初步的数据。</li>
<li>where 对数据进行普通的初步的筛选</li>
<li>group by 分组</li>
<li>各组分别执行 having 中的普通筛选或者聚合函数筛选</li>
<li>进而得到我们要的数据源，再进行 select，可以是普通字段查询也可以是获取聚合函数的查询结果，如果是聚合函数，select 的查询结果会新增一个字段。</li>
<li>将查询结果去重 distinct</li>
<li>最后合并各组的查询结果，按照 oder by 的条件进行排序</li>
</ol>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho2.jpg" alt="查询过程" title="查询过程.jpg"></p>
<h2 id="数据关联过程"><a href="#数据关联过程" class="headerlink" title="数据关联过程"></a>数据关联过程</h2><p>数据库中的两张表：</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho3.jpg" alt="数据表" title="数据表.jpg"></p>
<h3 id="from-amp-jion-amp-where"><a href="#from-amp-jion-amp-where" class="headerlink" title="from&amp;jion&amp;where"></a>from&amp;jion&amp;where</h3><p>用于确定我们要查询的表的范围，涉及那些表。<br>选择一张表，然后 jion 连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> table1 jion table2 <span class="keyword">on</span> table1.id<span class="operator">=</span>table2.id</span><br></pre></td></tr></table></figure>
<p>用于多张表，用 where 做关联条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> table1 jion table2 <span class="keyword">where</span> table1.id<span class="operator">=</span>table2.id</span><br></pre></td></tr></table></figure>
<p>我们会得到满足关联条件的两张表的数据，不加关联条件会出现笛卡尔积。</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho4.jpg" alt="关联表" title="关联表.jpg"></p>
<h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>按照我们的分组条件，将数据进行分组，但不会筛选数据。<br>比如按照 id 的奇偶分组：</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho5.jpg" alt="id 奇偶分组" title="id 奇偶分组.jpg"></p>
<h3 id="having-amp-where"><a href="#having-amp-where" class="headerlink" title="having&amp;where"></a>having&amp;where</h3><p>having 中可以是普通条件的筛选，也能是聚合函数，而 where 只能是聚合函数，一般情况下，有 having 可以不写 where，把 where 的筛选放在 having 里，SQL 语句看上去更顺滑。</p>
<h3 id="使用-where-再-group-by"><a href="#使用-where-再-group-by" class="headerlink" title="使用 where 再 group by"></a>使用 where 再 group by</h3><p>先把不满足where条件的数据删除，再去分组</p>
<h3 id="使用-group-by-再-where"><a href="#使用-group-by-再-where" class="headerlink" title="使用 group by 再 where"></a>使用 group by 再 where</h3><p>先分组再删除不满足 having 条件的数据，这两种方法有区别吗，几乎没有！<br>举个例子：<br>100/2=50，此时我们把 100 拆分 (10+10+10+10+10…)/2=5+5+5+…+5=50,只要筛选条件没变，即便是分组了也得满足筛选条件，所以 where后 group by 和 group by 再 having 是不影响结果的！</p>
<p>不同的是，having 语法支持聚合函数,其实 having 的意思就是针对每组的条件进行筛选。我们之前看到了普通的筛选条件是不影响的，但是having 还支持聚合函数，这是 where 无法实现的。<br>当前数据分组情况</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho6.jpg" alt="当前分组情况" title="当前分组情况.jpg"></p>
<p>执行 having 的筛选条件，可以使用聚合函数。筛选掉工资小于各组平均工资的 having salary&lt;avg(salary)</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho7.jpg" alt="分组后的情况" title="分组后的情况.jpg"></p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>分组结束之后，我们再执行 select 语句，因为聚合函数是依赖于分组的，聚合函数会单独新增一个查询出来的字段，这里用紫色表示，这里我们两个 id 重复了，我们就保留一个 id，重复字段名需要指向来自哪张表，否则会出现唯一性问题。最后按照用户名去重。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee.id,<span class="keyword">distinct</span> name,salary, <span class="built_in">avg</span>(salary)</span><br></pre></td></tr></table></figure>

<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho8.jpg" alt="select示意图" title="select示意图.jpg"></p>
<p>将各组having之后的数据再合并数据。</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho9.jpg" alt="having示意图" title="having示意图.jpg"></p>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>最后我们执行 order by 将数据按照一定顺序排序，比如这里按照 id 排序。如果此时有 limit 那么查询到相应的我们需要的记录数时，就不继续往下查了。</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho10.jpg" alt="order示意图" title="order示意图.jpg"></p>
<h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>记住 limit 是最后查询的，为什么呢？假如我们要查询年级最小的三个数据，如果在排序之前就截取到 3 个数据。实际上查询出来的不是最小的三个数据而是前三个数据了，记住这一点。</p>
<p>我们如果limit 0,3 窃取前三个数据再排序，实际上最少工资的是2000,3000,4000。你这里只能是4000,5000,8000了。</p>
<p><img src="/img/2022-12-04-%E5%9B%BE%E8%A7%A3SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/pho11.jpg" alt="limit示意图" title="limit示意图.jpg"></p>
<blockquote>
<p>参考<br>blog.csdn.net/weixin_44141495/article/details/108744720</p>
</blockquote>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/wu3227834">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
        data-repo="wu3227834/wu3227834.github.io"
        data-repo-id="R_kgDOIh8vuA"
        data-category="General"
        data-category-id="DIC_kwDOIh8vuM4CpDjz"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>




</html>

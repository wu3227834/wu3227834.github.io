<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:description" content="这里是小布丁的私有小屋"><meta property="og:type" content="website"><meta name="keywords" content="Linux内存管理, 内存调优, OOM分析, slab分配器, vmstat命令,"><meta name="description" content="深入剖析 Linux 内存管理机制，涵盖 malloc、brk、mmap、slab 分配器、OOM 杀手原理，并结合 free、top、vmstat 等命令，详解内存分析与调优实践，助你高效定位系统内存瓶颈。"><link rel="shortcut icon" href="/img/favicon.ico"><title>Linux性能调优：内存</title><link rel="stylesheet" href="/css/aircloud.css"><link rel="stylesheet" href="/css/gitment.css"><link rel="stylesheet" href="/css/prism.css"><link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css"><script></script><script defer src="https://cloud.umami.is/script.js" data-website-id="bad0a741-25cb-4dd6-bbcf-f5710aeb243c"></script><script type="text/javascript">((e,t,s,n,a,c)=>{e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},(a=t.createElement(n)).async=1,a.src="https://www.clarity.ms/tag/sgs6id3d37",(c=t.getElementsByTagName(n)[0]).parentNode.insertBefore(a,c)})(window,document,"clarity","script")</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Pudding 日常" type="application/atom+xml"></head><body><div class="site-nav-toggle" id="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><div class="index-about"><i>a week is 2% of the year</i></div><div class="index-container"><div class="index-left"><div class="nav" id="nav"><div class="avatar-name"><div class="avatar"><img src="/img/avatar.png"></div><div class="name"><i>Pudding</i></div></div><div class="contents" id="nav-content"><ul><li><a href="/"><i class="iconfont icon-shouye1"></i> <span>主页</span></a></li><li><a href="/tags"><i class="iconfont icon-biaoqian1"></i> <span>标签</span></a></li><li><a href="/archive"><i class="iconfont icon-guidang2"></i> <span>存档</span></a></li><li><a href="/about/"><i class="iconfont icon-guanyu2"></i> <span>关于</span></a></li><li><a id="search"><i class="iconfont icon-sousuo1"></i> <span>搜索</span></a></li></ul></div><div id="toc" class="toc-article"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%86%85%E5%AD%98%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">Linux内存工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6"><span class="toc-text">内存分配与回收</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-text">如何查看内存使用情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%9A%84-Buffer-%E5%92%8C-Cache"><span class="toc-text">内存的 Buffer 和 Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#free-%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9D%A5%E6%BA%90"><span class="toc-text">free 的数据来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#proc-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">proc 文件系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%B5%8B%E8%AF%95"><span class="toc-text">案例测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%B8%80%EF%BC%9A%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E5%86%99"><span class="toc-text">场景一：磁盘和文件写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%EF%BC%9A%E7%A3%81%E7%9B%98%E5%92%8C%E6%96%87%E4%BB%B6%E8%AF%BB"><span class="toc-text">场景二：磁盘和文件读</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li></ol></div></div><div class="search-field" id="search-field"><div class="search-bg" id="search-bg"></div><div class="search-container"><div class="search-input"><span id="esc-search"><i class="icon-fanhui iconfont"></i></span> <input id="search-input"> <span id="begin-search">搜索</span></div><div class="search-result-container" id="search-result-container"></div></div></div><div class="index-about-mobile"><i>a week is 2% of the year</i></div></div><div class="index-middle"><div class="post-container"><div class="post-title">Linux性能调优：内存</div><div class="post-meta"><span class="attr">发布于：<span>2025-05-28</span></span> <span class="attr">标签：/ <a class="tag" href="/tags/#Linux" title="Linux">Linux</a> <span>/</span> <a class="tag" href="/tags/#性能测试" title="性能测试">性能测试</a> <span>/</span> </span><span class="attr">访问：<span id="busuanzi_value_page_pv"></span></span></div><div class="post-content no-indent"><h2 id="Linux内存工作原理"><a href="#Linux内存工作原理" class="headerlink" title="Linux内存工作原理"></a>Linux内存工作原理</h2><h3 id="内存分配与回收"><a href="#内存分配与回收" class="headerlink" title="内存分配与回收"></a>内存分配与回收</h3><p>malloc() 是 C 标准库提供的内存分配函数，对应到系统调用上，有两种实现方式，即 brk() 和 mmap()。</p><p>对小块内存（小于 128K），C 标准库使用 brk() 来分配，也就是通过移动堆顶的位置来分配内存。这些内存释放后并不会立刻归还系统，而是被缓存起来，这样就可以重复使用。</p><p>对大块内存（大于 128K），则使用内存映射 mmap() 来分配，也就是在文件映射找一块空闲内存分配出去。</p><p>各自的<strong>优缺点</strong>：</p><ul><li>brk() 方式的缓存，可以减少缺页异常的发生，提高内存访问效率；不过，由于这些内存没有归还系统，在内存工作繁忙时，频繁的内存分配和释放会造成内存碎片</li><li>mmap() 方式分配的内存，会在释放时直接归还系统，所以每次 mmap 都会发生缺页异常。在内存工作繁忙时，频繁的内存分配会导致大量的缺页异常，使内核的管理负担增大</li></ul><p>整体来说，Linux 使用<strong>伙伴系统</strong>来管理内存分配。前面我们提到过，这些内存在 MMU 中以页为单位进行管理，伙伴系统也一样，以页为单位来管理内存，并且会通过相邻页的合并，减少内存碎片化（比如 brk 方法造成的内存碎片）。</p><p>在用户空间，malloc 通过 brk() 分配的内存，在释放时并不立即归还系统，而是缓存起来重复利用。在内核空间，Linux 通过 slab 分配器来管理小内存，可以把 slab 堪称构建在<strong>伙伴系统上的一个缓存</strong>，主要作用就是分配并释放内核中的小对象。</p><p>系统也不会任由某个进程用完所有内存。在发现内存紧张时，系统会通过一系列机制来回收内存：</p><ul><li>回收内存，比如使用 LRU（Least Recently Used）算法，回收最近使用最少的内存页面</li><li>回收不常访问的内存，把不常用的内存交换分区直接写到磁盘中（会用到交换分区）</li><li>杀死进程，内存紧张时系统还会通过 OOM（Out of Memory），直接杀掉占用大量内存的进程</li></ul><p>OOM 是内核的一种保护机制。它监控进程的内存使用情况，并且使用 oom_score 为每个进程的内存使用情况进行评分：</p><ul><li>进程消耗的内存越大，oom_score 就越大</li><li>进程运行占用的 CPU 越多，oom_score 就越小</li></ul><p>可以手动设置进程的 oom_adj 来调整 oom_score。oom_adj 的范围是 [-17, 15]，数值越大，进程越容易被杀死；反之，越不容易被杀死。</p><h3 id="如何查看内存使用情况"><a href="#如何查看内存使用情况" class="headerlink" title="如何查看内存使用情况"></a>如何查看内存使用情况</h3><p>1、free 命令</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ free</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:     <span class="number"> 262695500 </span> <span class="number"> 106731876 </span> <span class="number"> 141173212 </span>   <span class="number"> 4257008 </span>  <span class="number"> 14790412 </span>  149168720</span><br><span class="line">Swap:            <span class="number"> 0 </span>         <span class="number"> 0 </span>          0</span><br></pre></td></tr></table></figure><ul><li>total：总内存</li><li>used：已使用内存，包括共享内存</li><li>free：空闲内存</li><li>shared：共享内存</li><li>buff/cache：缓存内存，包括缓冲区和缓存</li><li>available：可用内存，包括空闲内存和缓存内存</li></ul><p><strong>注意</strong>：available 不仅包含未使用内存，还包括了可回收的缓存，所以一般会比未使用内存更大。不过，并不是所有缓存都可以回收，因为有些缓存可能正在使用中。</p><p>2、top 命令</p><p>可以查看每个进程的内存使用情况</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">top - 19:28:02 up<span class="number"> 201 </span>days,  2:48, <span class="number"> 2 </span>users,  load average: 134.36, 136.81, 111.38</span><br><span class="line">Tasks:<span class="number"> 1284 </span>total,  <span class="number"> 6 </span>running,<span class="number"> 1278 </span>sleeping,  <span class="number"> 0 </span>stopped,  <span class="number"> 0 </span>zombie</span><br><span class="line">%Cpu(s): 87.2 us,  8.9 sy,  0.0 ni,  0.9 id,  0.0 wa,  1.8 hi,  1.1 si,  0.0 st</span><br><span class="line">MiB Mem : 256538.6 total, 137892.3 free, 104201.3 used,  14445.0 buff/cache</span><br><span class="line">MiB Swap:      0.0 total,      0.0 free,      0.0 used. 145701.9 avail Mem</span><br><span class="line"></span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND</span><br><span class="line"><span class="number"> 607070 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span> 266.3g  82.5g <span class="number"> 79228 </span>S <span class="number"> 4861 </span> 33.0  40025:32 tabletserver_ma</span><br><span class="line"><span class="number"> 835494 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>8557368<span class="number"> 207048 </span><span class="number"> 10872 </span>S 121.7   0.1 357:04.40 java</span><br><span class="line"><span class="number"> 842048 </span>1001     <span class="number"> 20 </span> <span class="number"> 0 </span>  32.8g <span class="number"> 31168 </span><span class="number"> 14888 </span>S 113.0   0.0   0:03.41 java</span><br><span class="line"><span class="number"> 840498 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span><span class="number"> 727932 </span><span class="number"> 31336 </span> <span class="number"> 7304 </span>R  91.3   0.0   2164:46 node_exporter</span><br><span class="line"><span class="number"> 653917 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>  12.3g<span class="number"> 997944 </span><span class="number"> 46948 </span>S  78.3   0.4  15877:42 kubelet</span><br><span class="line">...</span><br></pre></td></tr></table></figure><ul><li>VIRT：虚拟内存，只要是进程申请过的内存，即便还没有真正分配物理内存，也会计算在内</li><li>RES：实际内存，也就是进程<strong>实际使用的物理内存</strong>大小，但<strong>不包括 Swap 和共享内存</strong></li><li>SHR：共享内存，比如与其他进程共同使用的共享内存、加载的动态链接库以及程序的代码段等</li><li>%MEM：进程占用的物理内存占系统总内存的百分比</li></ul><p><strong>注意</strong>：</p><ul><li>虚拟内存通常并不会全部分配物理内存。从上面的输出，你可以发现每个进程的虚拟内存都大于实际内存，这是因为虚拟内存是进程申请的内存，即使进程没有真正分配物理内存，也会计算在内。</li><li>共享内存 SHR 并不一定是共享的，比方说，<strong>程序的代码段、非共享的动态内存链接库</strong>，也都在 SHR 里。SHR 也包括了<strong>进程间真正共享的内存</strong>。所以在计算多个进程的内存使用时，不要把所有进程的 SHR 直接相加得出结果</li></ul><h2 id="内存的-Buffer-和-Cache"><a href="#内存的-Buffer-和-Cache" class="headerlink" title="内存的 Buffer 和 Cache"></a>内存的 Buffer 和 Cache</h2><h3 id="free-的数据来源"><a href="#free-的数据来源" class="headerlink" title="free 的数据来源"></a>free 的数据来源</h3><p>man free 查看</p><p><img src="/img/2025-05-28-linux_tracing_mem/image.png" alt="man free"></p><p>从手册看到：</p><ul><li>Buffers：Memory used by kernel buffers (Buffers in /proc/meminfo)</li><li>Cache：Memory used by the page cache and slabs (Cached and Slab in /proc/meminfo)</li></ul><h3 id="proc-文件系统"><a href="#proc-文件系统" class="headerlink" title="proc 文件系统"></a>proc 文件系统</h3><p>man proc 查看</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Buffers %lu</span><br><span class="line">       Relatively temporary storage <span class="keyword">for</span> raw disk blocks <span class="keyword">that</span> shouldn&#x27;t <span class="keyword">get</span> tremendously large (<span class="number">20</span>MB <span class="keyword">or</span> so).</span><br><span class="line"></span><br><span class="line">Cached %lu</span><br><span class="line">       In-memory cache <span class="keyword">for</span> files <span class="built_in">read</span> <span class="keyword">from</span> <span class="keyword">the</span> disk (<span class="keyword">the</span> page cache).  Doesn&#x27;t include SwapCached.</span><br><span class="line">...</span><br><span class="line">SReclaimable %lu (<span class="keyword">since</span> Linux <span class="number">2.6</span><span class="number">.19</span>)</span><br><span class="line">       Part <span class="keyword">of</span> Slab, <span class="keyword">that</span> might be reclaimed, such <span class="keyword">as</span> caches.</span><br><span class="line"></span><br><span class="line">SUnreclaim %lu (<span class="keyword">since</span> Linux <span class="number">2.6</span><span class="number">.19</span>)</span><br><span class="line">       Part <span class="keyword">of</span> Slab, <span class="keyword">that</span> cannot be reclaimed <span class="keyword">on</span> memory pressure.</span><br></pre></td></tr></table></figure><p>通过文档可以看到：</p><ul><li>Buffers 是对原始磁盘的临时存储，也就是用来缓存磁盘的数据，通常不会特别大（20MB 左右）。这样，内核就可以把分散的写集中起来，统一优化磁盘的写入，比如可以把多次小的写入合并成单次大的写等等。</li><li>Cached 是从单磁盘读取文件的页缓存，也就是用来缓存从文件读取的数据。这样，下次访问这些文件数据时，就可以直接从内存中快速获取，而不需要再次访问缓慢的磁盘。</li><li>Slab 代表内核数据结构缓存，包括两部分，其中的可回收部分，用 SReclaimable 记录；而不可回收部分，用 SUnreclaim 记录。</li></ul><h2 id="案例测试"><a href="#案例测试" class="headerlink" title="案例测试"></a>案例测试</h2><h3 id="场景一：磁盘和文件写"><a href="#场景一：磁盘和文件写" class="headerlink" title="场景一：磁盘和文件写"></a>场景一：磁盘和文件写</h3><p>运行 vmstat 命令</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ vmstat <span class="number">1</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">16790772</span>     <span class="number">60 8758252</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">24</span>    <span class="number">97</span>    <span class="number">0</span>    <span class="number">0</span> <span class="number">12</span>  <span class="number">6</span> <span class="number">82</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">0 1218088</span> <span class="number">16779960</span>     <span class="number">60 8762060</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">159 15274</span> <span class="number">28820 16</span>  <span class="number">9</span> <span class="number">75</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0 1218088</span> <span class="number">16779968</span>     <span class="number">60 8761840</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">154 13467</span> <span class="number">26984</span>  <span class="number">9</span>  <span class="number">4</span> <span class="number">87</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16778620</span>     <span class="number">60 8762068</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">212 13980</span> <span class="number">26715</span>  <span class="number">6</span>  <span class="number">5</span> <span class="number">89</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">0 1218088</span> <span class="number">16773376</span>     <span class="number">60 8762136</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">170 12838</span> <span class="number">25315</span>  <span class="number">4</span>  <span class="number">3</span> <span class="number">93</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0 1218088</span> <span class="number">16780544</span>     <span class="number">60 8762164</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">343 13195</span> <span class="number">25313</span>  <span class="number">5</span>  <span class="number">4</span> <span class="number">91</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16783260</span>     <span class="number">60 8762392</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">116 18099</span> <span class="number">33200 13 10</span> <span class="number">78</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">16782896</span>     <span class="number">60 8762400</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">40 10645</span> <span class="number">21760</span>  <span class="number">2</span>  <span class="number">2</span> <span class="number">96</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16780616</span>     <span class="number">60 8762412</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">97 12603</span> <span class="number">24496</span>  <span class="number">3</span>  <span class="number">3</span> <span class="number">94</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">16780708</span>     <span class="number">60 8762436</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">90 14724</span> <span class="number">27729</span>  <span class="number">9</span>  <span class="number">4</span> <span class="number">87</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">16779376</span>     <span class="number">60 8762472</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">116 12702</span> <span class="number">25101</span>  <span class="number">3</span>  <span class="number">3</span> <span class="number">93</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16775968</span>     <span class="number">60 8765976</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">133 16290</span> <span class="number">29873 19 10</span> <span class="number">71</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16783224</span>     <span class="number">60 8765996</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">89 13359</span> <span class="number">25299</span>  <span class="number">4</span>  <span class="number">3</span> <span class="number">93</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">16782604</span>     <span class="number">60 8766016</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">73 10976</span> <span class="number">22399</span>  <span class="number">2</span>  <span class="number">2</span> <span class="number">96</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">0 1218088</span> <span class="number">16775272</span>     <span class="number">60 8766032</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">122 13109</span> <span class="number">26159</span>  <span class="number">4</span>  <span class="number">2</span> <span class="number">94</span>  <span class="number">0</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure><ul><li>buff 和 cache 就是我们前面看到的 Buffers 和 Cache，单位是 KB</li><li>bi 和 bo 则分别表示块设备读取和写入的大小，单位为 块/秒。因为 Linux 中块的大小是 1KB，所以这个单位也就等价于 KB/s</li></ul><p>在另一中端执行 dd 命令通过读取随机设备，生成一个 500MB 大小的文件</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="attribute">if</span>=/dev/urandom <span class="attribute">of</span>=/mnt/disk1/log <span class="attribute">bs</span>=1M <span class="attribute">count</span>=500</span><br></pre></td></tr></table></figure><p>继续观察 buff 和 cache 的变化如下：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ vmstat 1</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu--<span class="language-yaml"><span class="meta">---</span></span></span><br><span class="line"><span class="language-yaml"> <span class="string">r</span>  <span class="string">b</span>   <span class="string">swpd</span>   <span class="string">free</span>   <span class="string">buff</span>  <span class="string">cache</span>   <span class="string">si</span>   <span class="string">so</span>    <span class="string">bi</span>    <span class="string">bo</span>   <span class="string">in</span>   <span class="string">cs</span> <span class="string">us</span> <span class="string">sy</span> <span class="string">id</span> <span class="string">wa</span> <span class="string">st</span></span></span><br><span class="line"><span class="language-yaml"> <span class="number">6</span>  <span class="number">0</span> <span class="number">1218088</span> <span class="number">16808024</span>     <span class="number">60</span> <span class="number">8706284</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">135</span> <span class="number">17194</span> <span class="number">30511</span> <span class="number">12</span>  <span class="number">5</span> <span class="number">82</span>  <span class="number">0</span>  <span class="number">0</span></span></span><br><span class="line"><span class="language-yaml"> <span class="number">2</span>  <span class="number">0</span> <span class="number">1218088</span> <span class="number">16812680</span>     <span class="number">60</span> <span class="number">8706316</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">108</span> <span class="number">14214</span> <span class="number">27386</span>  <span class="number">3</span>  <span class="number">2</span> <span class="number">94</span>  <span class="number">0</span>  <span class="number">0</span></span></span><br><span class="line"><span class="language-yaml"> <span class="number">0</span>  <span class="number">0</span> <span class="number">1218088</span> <span class="number">16822344</span>     <span class="number">60</span> <span class="number">8706268</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">82</span> <span class="number">12608</span> <span class="number">25281</span>  <span class="number">2</span>  <span class="number">2</span> <span class="number">96</span>  <span class="number">0</span>  <span class="number">0</span></span></span><br><span class="line"><span class="language-yaml"> <span class="number">0</span>  <span class="number">0</span> <span class="number">1218088</span> <span class="number">16828356</span>     <span class="number">60</span> <span class="number">8706284</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">65</span> <span class="number">16971</span> <span class="number">31578</span>  <span class="number">6</span>  <span class="number">5</span> <span class="number">89</span>  <span class="number">0</span>  <span class="number">0</span></span></span><br><span class="line"><span class="language-yaml"><span class="string">...</span></span></span><br><span class="line"><span class="number"> 1 </span><span class="number"> 2 </span>1218088<span class="number"> 16438876 </span>   <span class="number"> 60 </span>9110220   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span>264629<span class="number"> 19007 </span>27977 <span class="number"> 5 </span>20<span class="number"> 73 </span><span class="number"> 1 </span> 0</span><br><span class="line"><span class="number"> 8 </span><span class="number"> 1 </span>1218088<span class="number"> 16324916 </span>   <span class="number"> 60 </span>9227456   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span>22966<span class="number"> 20049 </span>31235<span class="number"> 13 </span>21<span class="number"> 61 </span><span class="number"> 5 </span> 0</span><br><span class="line"><span class="number"> 2 </span><span class="number"> 0 </span>1218088<span class="number"> 16329904 </span>   <span class="number"> 60 </span>9227244   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span> <span class="number"> 327 </span>11770<span class="number"> 24005 </span><span class="number"> 4 </span><span class="number"> 3 </span>87 <span class="number"> 7 </span> 0</span><br><span class="line"><span class="number"> 0 </span><span class="number"> 0 </span>1218088<span class="number"> 16329340 </span>   <span class="number"> 60 </span>9227248   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span>  <span class="number"> 91 </span>11558<span class="number"> 22878 </span><span class="number"> 3 </span><span class="number"> 2 </span>95 <span class="number"> 0 </span> 0</span><br><span class="line"><span class="number"> 5 </span><span class="number"> 0 </span>1218088<span class="number"> 16329532 </span>   <span class="number"> 60 </span>9227264   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span>  <span class="number"> 88 </span>14350<span class="number"> 28661 </span>10 <span class="number"> 5 </span>85 <span class="number"> 0 </span> 0</span><br><span class="line"><span class="number"> 1 </span><span class="number"> 0 </span>1218088<span class="number"> 16325480 </span>   <span class="number"> 60 </span>9227056   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span> <span class="number"> 162 </span>16735<span class="number"> 30309 </span>11 <span class="number"> 8 </span>81 <span class="number"> 0 </span> 0</span><br><span class="line"><span class="number"> 2 </span><span class="number"> 1 </span>1218088<span class="number"> 16325424 </span>   <span class="number"> 60 </span>9230360   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span>225680<span class="number"> 15589 </span>31332<span class="number"> 15 </span>10<span class="number"> 72 </span><span class="number"> 2 </span> 1</span><br><span class="line"><span class="number"> 1 </span><span class="number"> 0 </span>1218088<span class="number"> 16325160 </span>   <span class="number"> 60 </span>9231060   <span class="number"> 0 </span>  <span class="number"> 0 </span>   <span class="number"> 0 </span> <span class="number"> 124 </span>14815<span class="number"> 26517 </span>10 <span class="number"> 6 </span>79 <span class="number"> 5 </span> 0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到：</p><ul><li>在 dd 命令运行时，Cache 在不停地增长，而 Buffer 基本保持不变</li><li>在 dd 命令结束后，Cache 不再增长，但是块设备写还会持续一段时间，并且，多次 1/0 写的结果加起来，才是 dd 要写的 500M 的数据</li></ul><p>下面的命令对环境要求很高，需要你的系统配置多块磁盘，并且磁盘分区 /dev/sdb1 还要处于未使用状态。<strong>如果你只有一块磁盘，千万不要尝试，否则将会对你的磁盘分区造成损坏</strong>。</p><p>如果你的系统符合标准，就可以继续在第二个终端中，运行下面的命令。清理缓存后，向磁盘分区 /dev/sdb1 写入 2GB 的随机数据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">首先清理缓存</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后运行 <span class="built_in">dd</span> 命令向磁盘分区 /dev/sdb1 写入 2G 数据$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=/dev/sdb1 bs=1M count=2048</span></span><br></pre></td></tr></table></figure><p>然后，再回到终端一，观察内存和 I/O 的变化情况：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">procs</span> -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> <span class="attribute">r</span> b swpd free buff cache si so bi bo in cs us sy id wa st</span><br><span class="line"> <span class="attribute">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7584780</span> <span class="number">153592</span> <span class="number">97436</span> <span class="number">0</span> <span class="number">0</span> <span class="number">684</span> <span class="number">0</span> <span class="number">31</span> <span class="number">423</span> <span class="number">1</span> <span class="number">48</span> <span class="number">50</span> <span class="number">2</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7418580</span> <span class="number">315384</span> <span class="number">101668</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">32</span> <span class="number">144</span> <span class="number">0</span> <span class="number">50</span> <span class="number">50</span> <span class="number">0</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7253664</span> <span class="number">475844</span> <span class="number">106208</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">20</span> <span class="number">137</span> <span class="number">0</span> <span class="number">50</span> <span class="number">50</span> <span class="number">0</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7093352</span> <span class="number">631800</span> <span class="number">110520</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">23</span> <span class="number">223</span> <span class="number">0</span> <span class="number">50</span> <span class="number">50</span> <span class="number">0</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">6930056</span> <span class="number">790520</span> <span class="number">114980</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">12804</span> <span class="number">23</span> <span class="number">168</span> <span class="number">0</span> <span class="number">50</span> <span class="number">42</span> <span class="number">9</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">6757204</span> <span class="number">949240</span> <span class="number">119396</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">183804</span> <span class="number">24</span> <span class="number">191</span> <span class="number">0</span> <span class="number">53</span> <span class="number">26</span> <span class="number">21</span> <span class="number">0</span> </span><br><span class="line"> <span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">6591516</span> <span class="number">1107960</span> <span class="number">123840</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">77316</span> <span class="number">22</span> <span class="number">232</span> <span class="number">0</span> <span class="number">52</span> <span class="number">16</span> <span class="number">33</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>从这里你会看到，虽然同是写数据，写磁盘跟写文件的现象还是不同的。写磁盘时（也就是 bo 大于 0 时），Buffer 和 Cache 都在增长，但显然 Buffer 的增长快得多。</p><h3 id="场景二：磁盘和文件读"><a href="#场景二：磁盘和文件读" class="headerlink" title="场景二：磁盘和文件读"></a>场景二：磁盘和文件读</h3><p>运行文件读的命令如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件读</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">dd</span> <span class="keyword">if</span>=/mnt/disk1/log of=/dev/null</span></span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ echo <span class="number">3</span> &gt; /proc/sys/vm/drop_caches</span><br><span class="line">$ mstat <span class="number">1</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">22631652</span>      <span class="number">0 3037032</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">792</span>   <span class="number">225 15443</span> <span class="number">29060 17</span>  <span class="number">8</span> <span class="number">75</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">22629780</span>      <span class="number">0 3037096</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">48</span>    <span class="number">33 13210</span> <span class="number">25184</span>  <span class="number">3</span>  <span class="number">3</span> <span class="number">94</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">0 1218088</span> <span class="number">22474456</span>      <span class="number">0 3192744</span>    <span class="number">0</span>    <span class="number">0 155593</span>   <span class="number">379 11851</span> <span class="number">21896</span>  <span class="number">4</span>  <span class="number">6</span> <span class="number">89</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">0 1218088</span> <span class="number">22184464</span>      <span class="number">0 3471364</span>    <span class="number">0</span>    <span class="number">0 282644</span>   <span class="number">181 13324</span> <span class="number">22371</span>  <span class="number">5</span> <span class="number">12</span> <span class="number">83</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">22119672</span>      <span class="number">0 3549248</span>    <span class="number">0</span>    <span class="number">0 73920</span>    <span class="number">82 14720</span> <span class="number">26164</span>  <span class="number">7</span>  <span class="number">8</span> <span class="number">84</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">22118224</span>      <span class="number">0 3549468</span>    <span class="number">0</span>    <span class="number">0</span>   <span class="number">136</span>    <span class="number">29 17030</span> <span class="number">32835 13</span>  <span class="number">9</span> <span class="number">78</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0 1218088</span> <span class="number">22116736</span>      <span class="number">0 3549488</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">80</span>   <span class="number">327 11854</span> <span class="number">23476</span>  <span class="number">4</span>  <span class="number">2</span> <span class="number">93</span>  <span class="number">0</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure><p>运行磁盘读的命令如下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 磁盘读</span></span><br><span class="line">$ dd <span class="attribute">if</span>=/dev/vdc <span class="attribute">of</span>=/dev/null <span class="attribute">bs</span>=1M <span class="attribute">count</span>=1024</span><br></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ dvmstat <span class="number">1</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> <span class="number">6</span>  <span class="number">0 1218088</span> <span class="number">21827684</span>      <span class="number">0 3716568</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">24</span>    <span class="number">97</span>    <span class="number">0</span>    <span class="number">0</span> <span class="number">12</span>  <span class="number">6</span> <span class="number">82</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">0 1218088</span> <span class="number">21816680</span>      <span class="number">0 3721036</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">117 16130</span> <span class="number">30199 16 11</span> <span class="number">73</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">0 1218088</span> <span class="number">21819240</span>      <span class="number">0 3720212</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">9</span>   <span class="number">195 14200</span> <span class="number">26901</span>  <span class="number">6</span>  <span class="number">4</span> <span class="number">89</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">21818228</span>      <span class="number">0 3720252</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">4</span>   <span class="number">123 11836</span> <span class="number">23517</span>  <span class="number">3</span>  <span class="number">2</span> <span class="number">95</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">0 1218088</span> <span class="number">21802832</span>  <span class="number">14336</span> <span class="number">3720200</span>    <span class="number">0</span>    <span class="number">0 17369</span>   <span class="number">248 10953</span> <span class="number">21760</span>  <span class="number">3</span>  <span class="number">2</span> <span class="number">91</span>  <span class="number">4</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">1 1218088</span> <span class="number">21740512</span>  <span class="number">75776</span> <span class="number">3720308</span>    <span class="number">0</span>    <span class="number">0 58416</span>    <span class="number">77 14897</span> <span class="number">27732</span>  <span class="number">4</span>  <span class="number">5</span> <span class="number">79</span> <span class="number">11</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">1 1218088</span> <span class="number">21696460</span> <span class="number">133120</span> <span class="number">3720692</span>    <span class="number">0</span>    <span class="number">0 57344</span>    <span class="number">76 20717</span> <span class="number">40621 14 10</span> <span class="number">66</span>  <span class="number">9</span>  <span class="number">0</span></span><br><span class="line"><span class="number">10</span>  <span class="number">0 1218088</span> <span class="number">21639256</span> <span class="number">190464</span> <span class="number">3720328</span>    <span class="number">0</span>    <span class="number">0 57372</span>   <span class="number">349 18512</span> <span class="number">29321 11</span>  <span class="number">5</span> <span class="number">75</span> <span class="number">10</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">1 1218088</span> <span class="number">21600056</span> <span class="number">247808</span> <span class="number">3720308</span>    <span class="number">0</span>    <span class="number">0 57344</span>    <span class="number">72 17332</span> <span class="number">28977 10</span>  <span class="number">5</span> <span class="number">74</span> <span class="number">10</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">1 1218088</span> <span class="number">21539120</span> <span class="number">296960</span> <span class="number">3720340</span>    <span class="number">0</span>    <span class="number">0 49152</span>   <span class="number">688 22618</span> <span class="number">37060 16</span>  <span class="number">8</span> <span class="number">66</span>  <span class="number">9</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">1 1218088</span> <span class="number">21473532</span> <span class="number">354304</span> <span class="number">3720184</span>    <span class="number">0</span>    <span class="number">0 57348</span>   <span class="number">109 18331</span> <span class="number">30615</span>  <span class="number">9</span>  <span class="number">5</span> <span class="number">74</span> <span class="number">11</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">1</span>  <span class="number">1 1218088</span> <span class="number">21414276</span> <span class="number">407552</span> <span class="number">3723624</span>    <span class="number">0</span>    <span class="number">0 53248</span>   <span class="number">150 16057</span> <span class="number">29868 17</span>  <span class="number">9</span> <span class="number">64</span> <span class="number">10</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>  <span class="number">1 1218088</span> <span class="number">21356020</span> <span class="number">464896</span> <span class="number">3723924</span>    <span class="number">0</span>    <span class="number">0 57344</span>    <span class="number">29 14159</span> <span class="number">25301 12</span>  <span class="number">4</span> <span class="number">74</span> <span class="number">10</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">1 1218088</span> <span class="number">21302964</span> <span class="number">518144</span> <span class="number">3723736</span>    <span class="number">0</span>    <span class="number">0 53248</span>   <span class="number">147 10678</span> <span class="number">21725</span>  <span class="number">3</span>  <span class="number">2</span> <span class="number">84</span> <span class="number">12</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">0 1218088</span> <span class="number">21278632</span> <span class="number">542720</span> <span class="number">3724092</span>    <span class="number">0</span>    <span class="number">0 24576</span>   <span class="number">428 10163</span> <span class="number">21080</span>  <span class="number">2</span>  <span class="number">2</span> <span class="number">91</span>  <span class="number">5</span>  <span class="number">0</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">0 1218088</span> <span class="number">21269044</span> <span class="number">542720</span> <span class="number">3724072</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">73 15601</span> <span class="number">29313</span>  <span class="number">7</span>  <span class="number">5</span> <span class="number">88</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">23</span>  <span class="number">0 1218088</span> <span class="number">21272568</span> <span class="number">542720</span> <span class="number">3724488</span>    <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>    <span class="number">33 20061</span> <span class="number">36123 22 12</span> <span class="number">67</span>  <span class="number">0</span>  <span class="number">0</span></span><br></pre></td></tr></table></figure><p>可以看到，读取文件时（也就是 bi 大于 0 时），Buffer 保持不变，而 Cache 则在不停增长；而读取磁盘时，Cache 保持不变，Buffer 不断增长。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>Buffer 是对磁盘数据的缓存，而 Cache 是文件数据的缓存，它们既会用在读请求中，也会用在写请求中。</p><br><div id="comment-container"></div><div id="disqus_thread"></div><div id="lv-container"></div><div class="giscus"></div></div></div></div></div><footer class="footer"><ul class="list-inline text-center"><li><a target="_blank" href="https://github.com/wu3227834" rel="external nofollow noreferrer"><span class="fa-stack fa-lg"><i class="iconfont icon-github"></i></span></a></li></ul><p><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span>PV </span><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span>UV </span>Created By <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> Theme <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p></footer><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script><script type="text/javascript" src="/js/clipboard.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body><script>window.hexo_search_path="search.json",window.hexo_root="/",window.isPost=!0</script><script src="/js/index.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="/js/prism.js"></script><script src="https://giscus.app/client.js" data-repo="wu3227834/wu3227834.github.io" data-repo-id="R_kgDOIh8vuA" data-category="General" data-category-id="DIC_kwDOIh8vuM4CpDjz" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async></script><script>document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e;0<document.querySelectorAll(".index-middle img").length&&((e=document.createElement("link")).rel="stylesheet",e.href="/js/fancybox/jquery.fancybox.min.css",document.head.appendChild(e),(e=document.createElement("script")).src="/js/fancybox/jquery.fancybox.min.js",e.onload=function(){var e=document.createElement("script");e.src="/js/fancybox/wrapImage.js",document.body.appendChild(e)},document.body.appendChild(e))},1e3)})</script></html>